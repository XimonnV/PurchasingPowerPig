<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchasing Power Pig</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="start-state">
    <!-- Animation container - wraps all visual animation elements -->
    <div class="animation-container">
        <!-- Banner image at top center -->
        <div class="banner-container scaled-element">
            <img src="ppp-banner.png" alt="Purchasing Power Pig Banner">
        </div>

        <!-- Start state overlay (50% black) -->
        <div class="start-overlay" id="startOverlay"></div>

        <!-- Pig image container -->
        <div class="pig-container scaled-element">
            <img src="piggy.png" alt="Piggy Bank">
        </div>

        <!-- Banker image container -->
        <div class="banker-container scaled-element">
            <img src="banker.png" alt="Banker">
        </div>

        <!-- Banker's mug container -->
        <div class="banker-mug-container scaled-element">
            <div class="banker-mug-fill"></div>
        </div>

        <!-- Invisible oval container for drop fill effect -->
        <div class="pig-oval-container scaled-element">
            <div class="pig-oval-fill"></div>
        </div>

        <!-- Percentage display centered on pig -->
        <div class="pig-percentage scaled-element" id="pigPercentageDisplay">0%</div>
    </div>

    <!-- Panel container for left-side panels with automatic spacing -->
    <div class="panel-container">
        <div class="controls">
            <div class="control-group">
                <label>Monthly Savings: $<span id="savingsValue">100</span></label>
                <div class="slider-row">
                    <input type="range" id="savings" min="0" max="1000" value="100" step="10">
                    <button id="balanceSavings" class="balance-button" aria-label="Balance"></button>
                </div>
            </div>

            <div class="control-group">
                <label>Save in (exchange):</label>
                <div class="savings-vehicle-toggle" id="savingsVehicleToggle">
                    <input type="radio" id="savingsVehicleUsd" name="savingsVehicle" value="usd" checked>
                    <label for="savingsVehicleUsd" class="toggle-option">$</label>
                    <input type="radio" id="savingsVehicleBtc" name="savingsVehicle" value="btc">
                    <label for="savingsVehicleBtc" class="toggle-option">₿</label>
                    <div class="toggle-slider"></div>
                </div>
            </div>

            <div class="control-group">
                <label>Starting Amount: $<span id="startAmountValue">50000</span></label>
                <div class="slider-row">
                    <input type="range" id="startAmount" min="0" max="100000" value="50000" step="1000">
                    <button id="balanceStartAmount" class="balance-button" aria-label="Balance"></button>
                </div>
            </div>

            <div class="control-group">
                <label class="label-deemphasized"><i>Purchasing Power loss</i></label>
                <label>Debasement + CPI: <span id="inflationValue">7</span>%</label>
                <div class="slider-row">
                    <input type="range" id="inflation" min="5" max="20" value="7" step="0.1">
                    <button id="balanceInflation" class="balance-button" aria-label="Balance"></button>
                </div>
            </div>

            <div class="control-group">
                <button id="restartButton">Restart</button>
                <button id="pauseButton">Pause</button>
            </div>
        </div>

        <!-- Savings display panel -->
        <div class="savings-display">
            <div class="savings-label">Month: <span id="currentDateValue">2025 October</span></div>
            <div class="savings-label">Savings: <span id="totalSavingsValue">$0</span></div>
            <div class="savings-label">PP: <span id="ppValueFormatted">$(2025-Oct)0</span></div>
            <div class="savings-label">PP Lost: <span id="totalBankValue">0%</span></div>
        </div>

        <!-- Info panel -->
        <div class="info-display">
            <div class="info-text">
                A full pig equals the purchasing power of $<span id="baselineAmount">100K</span> at <span id="baselineDate">2025 October</span>
                <span id="infoExpandButton" class="info-expand-button" title="Click for more info">[+]</span>
                <div id="infoExpandedText" class="info-expanded-text" style="display: none;">
                    Over the medium/long run, persistent inflation is a monetary phenomenon: it requires money/liquidity to grow faster than real output (Fisher's M·V = P·Y). We therefore track 'debasement' as the growth of M relative to real activity and add it to CPI to capture latent and realized losses.
                </div>
            </div>
        </div>
    </div>

    <!-- Chart panel - separate container, positioned on right (desktop) or below panels (mobile) -->
    <div class="chart-panel">
        <!-- Empty for now - will contain chart content later -->
    </div>

    <!-- Load Plotly.js CDN for charting -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>

    <!-- Load JavaScript modules in dependency order -->
    <!-- 1. CONFIG - must load first -->
    <script src="config.js"></script>

    <!-- 2. Financial Math - uses CONFIG -->
    <script src="financial-math.js"></script>

    <!-- 3. DOM Cache - uses CONFIG -->
    <script src="dom-cache.js"></script>

    <!-- 4. State Manager - uses CONFIG, settingsCache, and financial-math functions -->
    <script src="state-manager.js"></script>

    <!-- 5. Viewport Manager - uses CONFIG and state-manager -->
    <script src="viewport-manager.js"></script>

    <!-- 6. Display Layer - handles all visual updates -->
    <script src="liquid-display-handler.js"></script>
    <script src="savings-display-handler.js"></script>
    <script src="date-display-handler.js"></script>
    <script src="ui-display-handler.js"></script>
    <script src="chart-handler.js"></script>
    <script src="display-manager.js"></script>

    <!-- 7. Effect Manager - handles visual effects (ripples, etc.) -->
    <script src="effect-manager.js"></script>

    <!-- 8. Utilities (Sprint 3 extraction) -->
    <script src="drop-size-calculator.js"></script>
    <script src="formatters.js"></script>
    <script src="cookie-settings.js"></script>

    <!-- 9. Drop System - modular drop components (Sprint 2 refactoring) -->
    <script src="drop-physics.js"></script>
    <script src="drop-renderer.js"></script>
    <script src="liquid-container.js"></script>
    <script src="drop-controller.js"></script>
    <script src="animation-engine.js"></script>
    <script src="timing-manager.js"></script>
    <script src="simulation-manager.js"></script>

    <!-- 10. UI Controllers - handle user interactions -->
    <script src="balance-controller.js"></script>
    <script src="start-state-controller.js"></script>
    <script src="savings-vehicle-controller.js"></script>

    <!-- 11. Main Application Controller (Sprint 3) -->
    <script src="app.js"></script>

    <!-- 12. Global Utility Functions -->
    <script>
        /**
         * Get the current scale factor from CSS
         * This reads the --scale CSS variable set by ViewportManager
         * @returns {number} Scale factor (default 1.0)
         */
        function getScaleFactor() {
            const scale = getComputedStyle(document.documentElement)
                .getPropertyValue('--scale').trim();
            return parseFloat(scale) || 1;
        }

        // Expose globally
        window.getScaleFactor = getScaleFactor;
    </script>

    <!-- 13. Initialize Application -->
    <script>
        // Create and initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const app = new PurchasingPowerPigApp();
                app.initialize();

                // Expose app globally for debugging and access
                window.app = app;

                // Legacy global functions for console debugging
                // These are kept for convenience when debugging in browser console.
                // Modern code should use window.app methods directly:
                //   - Use: window.app.start() instead of startSimulation()
                //   - Use: window.app.restart() instead of resetPigFill()
                //   - Use: window.app.togglePause() instead of togglePause()
                //   - Use: window.app.getSimulationManager().initializeFromStartingAmount() instead of initializeFromStartingAmount()
                window.startSimulation = () => {
                    console.log('startSimulation() called');
                    return window.app.start();
                };
                window.resetPigFill = () => {
                    console.log('resetPigFill() called');
                    return window.app.restart();
                };
                window.togglePause = () => {
                    console.log('togglePause() called');
                    return window.app.togglePause();
                };
                window.initializeFromStartingAmount = () => {
                    console.log('initializeFromStartingAmount() called');
                    return window.app.getSimulationManager().initializeFromStartingAmount();
                };

                console.log('✅ Application initialized successfully!');
            } catch (error) {
                console.error('❌ Failed to initialize application:', error);
            }
        });
    </script>
</body>
</html>
