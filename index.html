<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchasing Power Pig</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Banner image at top center -->
    <div class="banner-container scaled-element">
        <img src="ppp-banner.png" alt="Purchasing Power Pig Banner">
    </div>
    
    <!-- Pig image container -->
    <div class="pig-container scaled-element">
        <img src="piggy.png" alt="Piggy Bank">
    </div>
    
    <!-- Banker image container -->
    <div class="banker-container scaled-element">
        <img src="banker.png" alt="Banker">
    </div>
    
    <!-- Banker's mug container -->
    <div class="banker-mug-container scaled-element">
        <div class="banker-mug-fill"></div>
    </div>
    
    <!-- Invisible oval container for drop fill effect -->
    <div class="pig-oval-container scaled-element">
        <div class="pig-oval-fill"></div>
    </div>
    
    <!-- Panel container for right-side panels with automatic spacing -->
    <div class="panel-container">
        <div class="controls">
            <div class="control-group">
                <label>Starting Amount: $<span id="startAmountValue">50000</span></label>
                <div class="slider-row">
                    <input type="range" id="startAmount" min="0" max="100000" value="50000" step="1000">
                    <button id="balanceStartAmount" class="balance-button" aria-label="Balance"></button>
                </div>
            </div>
            
            <div class="control-group">
                <label class="label-deemphasized"><i>Purchasing Power loss</i></label>
                <label>Debasement + CPI: <span id="inflationValue">7</span>%</label>
                <div class="slider-row">
                    <input type="range" id="inflation" min="5" max="20" value="7" step="0.1">
                    <button id="balanceInflation" class="balance-button" aria-label="Balance"></button>
                </div>
            </div>
            
            <div class="control-group">
                <label>Monthly Savings: $<span id="savingsValue">100</span></label>
                <div class="slider-row">
                    <input type="range" id="savings" min="0" max="1000" value="100" step="10">
                    <button id="balanceSavings" class="balance-button" aria-label="Balance"></button>
                </div>
            </div>
            
            <div class="control-group">
                <button id="restartButton">Restart</button>
                <button id="pauseButton">Pause</button>
            </div>
        </div>

        <!-- Savings display panel -->
        <div class="savings-display">
            <div class="savings-label">Savings: <span id="totalSavingsValue">$0</span></div>
            <div class="savings-label">PP Lost: <span id="totalBankValue">0%</span></div>
            <div class="savings-label">Date: <span id="currentDateValue">2025 October</span></div>
        </div>

        <!-- Info panel -->
        <div class="info-display">
            <div class="info-text">A full pig equals the purchasing power of $100K at 2025 October</div>
        </div>
    </div>

    <!-- Debug display -->
    <div class="debug-display">
        Pig: <span id="debugFillValue">0.00</span>%<br>
        <!--Mug: <span id="debugMugValue">0.00</span>% | Bank $: <span id="debugBankDollars">$0</span> -->
        <!--Mug: <span id="debugMugValue">0.00</span>% -->
    </div>

    <script>
        // Calculate balanced starting amount (rounds to nearest 1000)
        function calculateBalancedStartAmount(monthlySavings, annualInflationPercent) {
            const annualInflation = annualInflationPercent / 100;
            
            let calculatedAmount;
            
            // Handle division by zero (set to max if inflation is 0)
            if (annualInflation === 0) {
                calculatedAmount = 100000;
            } else {
                // Calculate: (monthly savings * 12) / annual inflation
                calculatedAmount = (monthlySavings * 12) / annualInflation;
                // Round to nearest 1000 (slider step)
                calculatedAmount = Math.round(calculatedAmount / 1000) * 1000;
                // Clamp to min/max range
                calculatedAmount = Math.max(0, Math.min(100000, calculatedAmount));
            }
            
            return calculatedAmount;
        }
        
        // Calculate balanced monthly savings (rounds to nearest 10)
        function calculateBalancedSavings(startingAmount, annualInflationPercent) {
            const annualInflation = annualInflationPercent / 100;
            
            // Calculate: (starting amount * annual inflation) / 12
            let calculatedSavings = (startingAmount * annualInflation) / 12;
            // Round to nearest 10 (slider step)
            calculatedSavings = Math.round(calculatedSavings / 10) * 10;
            // Clamp to min/max range
            calculatedSavings = Math.max(0, Math.min(1000, calculatedSavings));
            
            return calculatedSavings;
        }
        
        // Calculate balanced inflation (rounds to nearest 0.1)
        function calculateBalancedInflation(startingAmount, monthlySavings) {
            let calculatedInflation;
            
            // Handle division by zero (set to default 7% if starting amount is 0)
            if (startingAmount === 0) {
                calculatedInflation = 7;
            } else {
                // Calculate: (monthly savings * 12) / starting amount * 100 to get percentage
                calculatedInflation = (monthlySavings * 12) / startingAmount * 100;
                // Round to 1 decimal place (slider step is 0.1)
                calculatedInflation = Math.round(calculatedInflation * 10) / 10;
                // Clamp to min/max range
                calculatedInflation = Math.max(5, Math.min(20, calculatedInflation));
            }
            
            return calculatedInflation;
        }
        
        // Function to set balance icon for all three buttons
        function setBalanceIcon(iconFile) {
            const buttons = [
                document.getElementById('balanceStartAmount'),
                document.getElementById('balanceInflation'),
                document.getElementById('balanceSavings')
            ];
            buttons.forEach(button => {
                if (button) {
                    button.style.backgroundImage = `url('${iconFile}')`;
                }
            });
        }
        
        // Function to check if values are balanced
        function checkBalance() {
            const currentStartAmount = parseInt(document.getElementById('startAmount').value);
            const currentInflation = parseFloat(document.getElementById('inflation').value);
            const currentSavings = parseInt(document.getElementById('savings').value);
            
            // Calculate what each balanced value would be
            const balancedStartAmount = calculateBalancedStartAmount(currentSavings, currentInflation);
            const balancedSavings = calculateBalancedSavings(currentStartAmount, currentInflation);
            const balancedInflation = calculateBalancedInflation(currentStartAmount, currentSavings);
            
            // Check if any of the three calculations match current values
            const startAmountMatches = (currentStartAmount === balancedStartAmount);
            const savingsMatches = (currentSavings === balancedSavings);
            const inflationMatches = (currentInflation === balancedInflation);
            
            const isBalanced = startAmountMatches || savingsMatches || inflationMatches;
            
            // Update icon for all buttons
            setBalanceIcon(isBalanced ? 'balance.png' : 'balance-tilt.png');
        }
        
        document.getElementById('startAmount').addEventListener('input', (e) => {
            document.getElementById('startAmountValue').textContent = e.target.value;
            if (typeof window.initializeFromStartingAmount === 'function') {
                window.initializeFromStartingAmount();
            }
            checkBalance(); // Check balance after manual adjustment
        });
        
        document.getElementById('inflation').addEventListener('input', (e) => {
            document.getElementById('inflationValue').textContent = e.target.value;
            checkBalance(); // Check balance after manual adjustment
        });
        
        document.getElementById('savings').addEventListener('input', (e) => {
            document.getElementById('savingsValue').textContent = e.target.value;
            checkBalance(); // Check balance after manual adjustment
        });
        
        document.getElementById('restartButton').addEventListener('click', () => {
            if (typeof window.resetPigFill === 'function') {
                window.resetPigFill();
            }
        });
        
        document.getElementById('pauseButton').addEventListener('click', () => {
            if (typeof window.togglePause === 'function') {
                window.togglePause();
            }
        });
        
        // Balance button for Starting Amount - calculates optimal starting amount
        document.getElementById('balanceStartAmount').addEventListener('click', () => {
            const monthlySavings = parseInt(document.getElementById('savings').value);
            const annualInflationPercent = parseFloat(document.getElementById('inflation').value);
            
            const calculatedAmount = calculateBalancedStartAmount(monthlySavings, annualInflationPercent);
            
            // Set all buttons to balanced icon immediately
            setBalanceIcon('balance.png');
            
            // Set the slider value
            const startAmountSlider = document.getElementById('startAmount');
            startAmountSlider.value = calculatedAmount;
            
            // Update display value manually
            document.getElementById('startAmountValue').textContent = calculatedAmount;
            if (typeof window.initializeFromStartingAmount === 'function') {
                window.initializeFromStartingAmount();
            }
        });
        
        // Balance button for Monthly Savings - calculates optimal monthly savings
        document.getElementById('balanceSavings').addEventListener('click', () => {
            const startingAmount = parseInt(document.getElementById('startAmount').value);
            const annualInflationPercent = parseFloat(document.getElementById('inflation').value);
            
            const calculatedSavings = calculateBalancedSavings(startingAmount, annualInflationPercent);
            
            // Set all buttons to balanced icon immediately
            setBalanceIcon('balance.png');
            
            // Set the slider value
            const savingsSlider = document.getElementById('savings');
            savingsSlider.value = calculatedSavings;
            
            // Update display value manually
            document.getElementById('savingsValue').textContent = calculatedSavings;
        });
        
        // Balance button for Inflation - calculates optimal inflation rate
        document.getElementById('balanceInflation').addEventListener('click', () => {
            const startingAmount = parseInt(document.getElementById('startAmount').value);
            const monthlySavings = parseInt(document.getElementById('savings').value);
            
            const calculatedInflation = calculateBalancedInflation(startingAmount, monthlySavings);
            
            // Set all buttons to balanced icon immediately
            setBalanceIcon('balance.png');
            
            // Set the slider value
            const inflationSlider = document.getElementById('inflation');
            inflationSlider.value = calculatedInflation;
            
            // Update display value manually
            document.getElementById('inflationValue').textContent = calculatedInflation;
        });
        
        // Set initial state to balance-tilt.png on page load
        setBalanceIcon('balance-tilt.png');
    </script>
    <script src="ppl-animation.js"></script>
</body>
</html>
